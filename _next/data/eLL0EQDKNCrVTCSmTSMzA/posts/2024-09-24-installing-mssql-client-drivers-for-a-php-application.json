{"pageProps":{"post":{"slug":"2024-09-24-installing-mssql-client-drivers-for-a-php-application","markdownBody":"\nI just had the pleasure (*cough*) to connect an [MSSQL](https://de.wikipedia.org/wiki/Microsoft_SQL_Server) database to a [Laravel](https://laravel.com/) application at work. Because the process was *super* tedious, I wanted to quickly jot this down so I will never have to go through this again.\r\n\r\n## Our setup\r\n\r\nWe're building a Laravel application with [DDEV](https://ddev.com/). DDEV essentially moves all development tools into Docker containers and adds some nice features like local database management.\r\n\r\n## The process\r\n\r\nLaravel comes with the boilerplate to use MSSQL out of the box. In your app, just set the database config to use `sqlsrv`:\r\n\r\n```php\r\n    'connections' => [\r\n        'sqlsrv' => [\r\n            'driver' => 'sqlsrv',\r\n            'url' => env('DB_URL'),\r\n            'host' => env('DB_HOST', '127.0.0.1'),\r\n            'port' => env('DB_PORT', '1433'),\r\n            'database' => env('DB_DATABASE', 'laravel'),\r\n            'username' => env('DB_USERNAME', 'root'),\r\n            'password' => env('DB_PASSWORD', ''),\r\n            'unix_socket' => env('DB_SOCKET', ''),\r\n            'charset' => env('DB_CHARSET', 'utf8'),\r\n            'prefix' => '',\r\n            'prefix_indexes' => true,\r\n            // 'encrypt' => env('DB_ENCRYPT', 'yes'),\r\n            // 'trust_server_certificate' => env('DB_TRUST_SERVER_CERTIFICATE', 'false'),\r\n        ],\r\n    ],\r\n```\r\n\r\nYou will see errors when starting your app, because you need to install the corresponding drivers first. Instead of adding them through [Composer](https://getcomposer.org/) (a widely adopted package manager for PHP), you have to install the ODBC drivers **through the system package manager**, because Microsoft doesn't maintain a PHP package. Furthermore, you also have to install the driver repository because **Microsoft doesn't even maintain packages for the major Linux distributions**. In our setup with DDEV, this has to be done by amending the Dockerfile used for the application container. Create a file at `.ddev/web-build/Dockerfile` and add the following contents:\r\n\r\n```dockerfile\r\n# https://ddev.readthedocs.io/en/stable/users/extend/customizing-images/#adding-extra-dockerfiles-for-webimage-and-dbimage\r\n# https://stackoverflow.com/questions/58086933/how-to-install-the-sql-server-php-drivers-in-ddev-local#new-answer\r\nARG BASE_IMAGE\r\nFROM $BASE_IMAGE\r\n\r\nRUN npm install --global forever\r\nRUN echo \"Built on $(date)\" > /build-date.txt\r\n\r\n# RUN curl https://packages.microsoft.com/keys/microsoft.asc | sudo apt-key add -\r\n# RUN curl https://packages.microsoft.com/config/debian/11/prod.list > /etc/apt/sources.list.d/mssql-release.list\r\n\r\nRUN curl -fsSL https://packages.microsoft.com/keys/microsoft.asc | sudo gpg --dearmor -o /usr/share/keyrings/microsoft-prod.gpg\r\nRUN curl https://packages.microsoft.com/config/debian/12/prod.list | sudo tee /etc/apt/sources.list.d/mssql-release.list\r\n\r\nRUN apt-get update\r\nRUN apt-get --allow-downgrades -y install libssl-dev\r\nRUN apt-get -y update && yes | ACCEPT_EULA=Y apt-get -y install php8.3-dev php-pear unixodbc-dev htop\r\nRUN ACCEPT_EULA=Y apt-get -y install msodbcsql18 mssql-tools18\r\nRUN sudo pecl channel-update pecl.php.net\r\nRUN sudo pecl install sqlsrv\r\nRUN sudo pecl install pdo_sqlsrv\r\n\r\nRUN sudo printf \"; priority=20\\nextension=sqlsrv.so\\n\" > /etc/php/8.3/mods-available/sqlsrv.ini\r\nRUN sudo printf \"; priority=30\\nextension=pdo_sqlsrv.so\\n\" > /etc/php/8.3/mods-available/pdo_sqlsrv.ini\r\nRUN sudo phpenmod -v 8.3 -s cli sqlsrv pdo_sqlsrv\r\nRUN sudo phpenmod -v 8.3 -s fpm sqlsrv pdo_sqlsrv\r\nRUN sudo phpenmod -v 8.3 -s apache2 sqlsrv pdo_sqlsrv\r\n\r\nRUN sudo printf \"; priority=20\\nextension=sqlsrv.so\\n\" > /etc/php/8.3/mods-available/sqlsrv.ini\r\nRUN sudo printf \"; priority=30\\nextension=pdo_sqlsrv.so\\n\" > /etc/php/8.3/mods-available/pdo_sqlsrv.ini\r\nRUN sudo phpenmod -v 8.3 -s cli sqlsrv pdo_sqlsrv\r\nRUN sudo phpenmod -v 8.3 -s fpm sqlsrv pdo_sqlsrv\r\nRUN sudo phpenmod -v 8.3 -s apache2 sqlsrv pdo_sqlsrv\r\n\r\nRUN echo 'export PATH=\"$PATH:/opt/mssql-tools/bin\"' >> ~/.bash_profile\r\n```\r\n\r\nIf you're reading this in the future and Microsoft may have released a new version of the ODBC drivers, you may have to follow the new [installation instructions from their documentation](https://learn.microsoft.com/de-de/sql/connect/odbc/linux-mac/installing-the-microsoft-odbc-driver-for-sql-server?view=sql-server-ver16&tabs=debian18-install%2Calpine17-install%2Cdebian8-install%2Credhat7-13-install%2Crhel7-offline#18). It took me a while to realize that I couldn't install version 17 of the driver because I was using the installation instructions for version 18. They are apparently incompatible with each other.\r\n\r\nI hope that you'll never have to touch the shithole that is MSSQL, but if you do, I hope that this guide will be of value to you.\n","frontmatter":{"title":"Installing MSSQL Client Drivers for a PHP Application","date":"2024-09-24","tags":"guide, note, web, tech, programming, php"},"tags":["guide","note","web","tech","programming","php"]},"recommendedPosts":[{"slug":"2024-08-31-sentiment-analysis-using-ml-models","frontmatter":{"title":"Sentiment analysis using ML models","date":"2024-08-31","tags":"note, tech, ai"},"tags":["note","tech","ai"]},{"slug":"2024-08-03-how-embedding-models-encode-semantic-meaning","frontmatter":{"title":"How embedding models encode semantic meaning","date":"2024-08-03","tags":"note, tech, math, llm, ai"},"tags":["note","tech","math","llm","ai"]},{"slug":"2024-07-02-linkdump-llms","frontmatter":{"title":"ðŸ”— Linkdump: LLMs","date":"2024-07-02","tags":"note, tech, linkdump, llm, ai"},"tags":["note","tech","linkdump","llm","ai"]},{"slug":"2024-06-27-testing-smtp-connections","frontmatter":{"title":"Testing SMTP connections","date":"2024-06-27","tags":"infrastructure, guide, note, learnings, tech"},"tags":["infrastructure","guide","note","learnings","tech"]},{"slug":"2024-06-17-host-your-own-llm","frontmatter":{"title":"Host your own LLM","date":"2024-06-17","tags":"infrastructure, guide, note, homelab, tech, llm, ai"},"tags":["infrastructure","guide","note","homelab","tech","llm","ai"]}]},"__N_SSG":true}