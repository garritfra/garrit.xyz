<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><title>Serverless Framework Retrospective | Garrit&#x27;s Notes</title><meta name="Description" content="Generalist developer writing about fullstack development, system administration and free software."/><link rel="icon" type="image/svg+xml" href="/favicon.svg"/><link rel="webmention" href="https://webmention.io/garrit.xyz/webmention"/><link rel="pingback" href="https://webmention.io/garrit.xyz/xmlrpc"/><link href="https://cdn.jsdelivr.net/npm/shareon@2/dist/shareon.min.css" rel="stylesheet"/><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/d7b5a815c8fda5f6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d7b5a815c8fda5f6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-305cb810cde7afac.js" defer=""></script><script src="/_next/static/chunks/main-108f4624a742a542.js" defer=""></script><script src="/_next/static/chunks/pages/_app-0ffc73a1b90cb292.js" defer=""></script><script src="/_next/static/chunks/996-fdc974ad4451cc3b.js" defer=""></script><script src="/_next/static/chunks/146-c7cdb36402b1e656.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bpost%5D-5074f726cf5b0735.js" defer=""></script><script src="/_next/static/HsdJIwXJDgyLfxcJkrRTY/_buildManifest.js" defer=""></script><script src="/_next/static/HsdJIwXJDgyLfxcJkrRTY/_ssgManifest.js" defer=""></script></head><body><div id="__next"><section class="layout"><header class="header"><nav class="nav" role="navigation" aria-label="main navigation"><div class="header__container"><a href="/" class="header__container__logo underlined">Garrit&#x27;s Notes</a></div><ul class="header__links"><li><a href="/posts" class="underlined">Blog</a></li><li><a href="/contact" class="underlined">Contact</a></li><li><a href="/cv" class="underlined">Resume</a></li></ul></nav></header><div class="content"><article class="page h-entry"><div class="page__info"><h1 class="p-name">Serverless Framework Retrospective</h1><time class="page__info__date">Apr 28 2023</time></div><div class="page__body e-content"><p>A current project requires the infrastructure to be highly scalable. It&#x27;s expected that &gt; 50k Users hit the platform within a five minute period. Regular ECS containers take about one minute to scale up. That just won&#x27;t cut it. I decided to go all in on the <a href="https://www.serverless.com/">serverless</a> framework on AWS. Here&#x27;s how it went.</p>
<h3 id="setup" level="3">Setup</h3>
<p>Setting up a serverless application was a breeze. You create a config file and use their CLI to deploy the app.</p>
<h3 id="the-rest-of-the-infrastructure" level="3">The rest of the infrastructure</h3>
<p>I decided to define the rest of the infrastructure (VPC, DB, cache, ...) in Terraform. But, since I wasn&#x27;t familiar with how the Serverless Framework worked, I struggled to draw the line between what serverless should handle vs. what the rest of the infrastructure (Terraform) should provide. In a more traditional deployment workflow, you might let the CI deploy a container image to ECR and point the ECS service to that new image.</p>
<p>I chose to let Serverless deploy the entire app through CI and build the rest of the infrastructure around it. The problem with this approach is that we lose fine-grained control over what&#x27;s deployed where, which leads to a lot of permission errors.</p>
<p>In retrospect, I should&#x27;ve probably chosen the location of the S3 archive as the deployment target for the CI, and then point the lambda function to the location of the new artifact. This defeats the purpose of the framework, but it gives you a lot more control over your infrastructure. Once the next project comes along, I&#x27;ll probably go that route instead.</p>
<h3 id="permissions" level="3">Permissions</h3>
<p>Serverless suggests to use admin permissions for deployments, and I see where they&#x27;re coming from. Managing permissions in this framework is an absolute mess. Here&#x27;s what the average deployment workflow looks like, if you want to use fine grained permissions:</p>
<ol>
<li>Wait for CloudFormation to roll back changes (~2 minutes)</li>
<li>Update IAM role</li>
<li>Deploy Serverless App</li>
<li>If there&#x27;s an error, go to 1</li>
</ol>
<p>Thankfully, some people have already gone through the process of figuring this out. <a href="https://serverlessfirst.com/create-iam-deployer-roles-serverless-app/#determining-deploy-time-permissions">Here&#x27;s</a> a great guide with a starting point of the needed permissions.</p>
<h3 id="conclusion" level="3">Conclusion</h3>
<p>Using the serverless framework is a solid choice if you just want to throw an app out there. Unfortunately the app I was deploying isn&#x27;t &quot;just&quot; a dynamic website. The next time I&#x27;m building a serverless application it&#x27;s probably not going to be with the Serverless Framework, though I learned a lot about serverless applications in general.</p>
<hr/>
<p>This is post 067 of <a href="https://100daystooffload.com/">#100DaysToOffload</a>.</p><hr/><p><a href="mailto:garrit@slashdev.space?subject=Re: Serverless%20Framework%20Retrospective">Reply via E-Mail</a></p><a href="https://www.buymeacoffee.com/garrit" target="_blank"><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee&amp;emoji=&amp;slug=garrit&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Cookie&amp;outline_colour=000000&amp;coffee_colour=ffffff"/></a><p class="page__tag-list"><svg class="page__tag-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><a href="/posts?tags=100DaysToOffload">#<!-- -->100DaysToOffload</a><a href="/posts?tags=infrastructure">#<!-- -->infrastructure</a><a href="/posts?tags=aws">#<!-- -->aws</a><a href="/posts?tags=note">#<!-- -->note</a><a href="/posts?tags=terraform">#<!-- -->terraform</a><a href="/posts?tags=learnings">#<!-- -->learnings</a><a href="/posts?tags=devops">#<!-- -->devops</a><a href="/posts?tags=serverless">#<!-- -->serverless</a></p><div class="shareon"><a class="facebook"></a><a class="linkedin"></a><a class="mastodon"></a><a class="pocket"></a><a class="reddit"></a><a class="telegram"></a><a class="twitter"></a><a class="whatsapp"></a></div><hr/><h2>Continue Reading</h2><div><div class="blog__list__post"><time class="blog__list__post__date">Jul 11 2023</time><br/><a href="/posts/2023-07-11-principles-of-devops-introduction">Principles of DevOps: Introduction</a></div><div class="blog__list__post"><time class="blog__list__post__date">May 19 2023</time><br/><a href="/posts/2023-05-19-work-batch-sizing">Optimizing work batch size</a></div><div class="blog__list__post"><time class="blog__list__post__date">Apr 22 2023</time><br/><a href="/posts/2023-04-22-the-role-of-a-devops-engineer">The role of a DevOps Engineer</a></div><div class="blog__list__post"><time class="blog__list__post__date">Apr 12 2023</time><br/><a href="/posts/2023-04-12-instant-dark-theme">Instant dark theme</a></div><div class="blog__list__post"><time class="blog__list__post__date">Mar 30 2023</time><br/><a href="/posts/2023-03-30-designing-resilient-cloud-infrastructure">Designing resilient cloud infrastructure</a></div></div></div></article></div><footer class="footer"><div class="footer__content"><h3>Links of Interest</h3><a href="/rss.xml">RSS Feed</a><br/><a href="/todo">Todo List</a><br/><a href="https://keyoxide.org/hkp/garrit@slashdev.space">PGP Key</a><br/><a href="/guestbook">Guestbook</a><br/><a href="/blogroll">Blogroll</a><br/><a href="/ctf">Capture the Flag</a><h3>Elsewhere</h3><a href="https://github.com/garritfra" rel="me">Github</a><br/><a href="https://www.linkedin.com/in/garritfranke/">LinkedIn</a><br/><a href="https://fosstodon.org/@garritfra">Mastodon (ActivityPub)</a><br/><a href="/contact">Contact</a></div><p>ðŸ‘»Â Proud member of <a target="_blank" href="https://darktheme.club/">darktheme.club</a> <!-- -->ðŸ‘»</p><p>Â© 2018-<!-- -->2023<!-- --> Garrit Franke<br/><a href="/privacy">Privacy</a> |<!-- --> <a target="_blank" href="https://github.com/garritfra/garrit.xyz">Source Code</a></p></footer></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"2023-04-28-serverless-framework-retrospective","markdownBody":"\nA current project requires the infrastructure to be highly scalable. It's expected that \u003e 50k Users hit the platform within a five minute period. Regular ECS containers take about one minute to scale up. That just won't cut it. I decided to go all in on the [serverless](https://www.serverless.com/) framework on AWS. Here's how it went.\r\n\r\n### Setup\r\n\r\nSetting up a serverless application was a breeze. You create a config file and use their CLI to deploy the app.\r\n\r\n### The rest of the infrastructure\r\n\r\nI decided to define the rest of the infrastructure (VPC, DB, cache, ...) in Terraform. But, since I wasn't familiar with how the Serverless Framework worked, I struggled to draw the line between what serverless should handle vs. what the rest of the infrastructure (Terraform) should provide. In a more traditional deployment workflow, you might let the CI deploy a container image to ECR and point the ECS service to that new image.\r\n\r\nI chose to let Serverless deploy the entire app through CI and build the rest of the infrastructure around it. The problem with this approach is that we lose fine-grained control over what's deployed where, which leads to a lot of permission errors.\r\n\r\nIn retrospect, I should've probably chosen the location of the S3 archive as the deployment target for the CI, and then point the lambda function to the location of the new artifact. This defeats the purpose of the framework, but it gives you a lot more control over your infrastructure. Once the next project comes along, I'll probably go that route instead.\r\n\r\n### Permissions\r\n\r\nServerless suggests to use admin permissions for deployments, and I see where they're coming from. Managing permissions in this framework is an absolute mess. Here's what the average deployment workflow looks like, if you want to use fine grained permissions:\r\n\r\n1. Wait for CloudFormation to roll back changes (~2 minutes)\r\n2. Update IAM role\r\n3. Deploy Serverless App\r\n4. If there's an error, go to 1\r\n\r\nThankfully, some people have already gone through the process of figuring this out. [Here's](https://serverlessfirst.com/create-iam-deployer-roles-serverless-app/#determining-deploy-time-permissions) a great guide with a starting point of the needed permissions.\r\n\r\n### Conclusion\r\n\r\nUsing the serverless framework is a solid choice if you just want to throw an app out there. Unfortunately the app I was deploying isn't \"just\" a dynamic website. The next time I'm building a serverless application it's probably not going to be with the Serverless Framework, though I learned a lot about serverless applications in general.\r\n\r\n---\r\n\r\nThis is post 067 of [#100DaysToOffload](https://100daystooffload.com/).\r\n\r\n\r\n\r\n\n","frontmatter":{"title":"Serverless Framework Retrospective","date":"2023-04-28","tags":"100DaysToOffload, infrastructure, aws, note, terraform, learnings, devops, serverless"},"tags":["100DaysToOffload","infrastructure","aws","note","terraform","learnings","devops","serverless"]},"recommendedPosts":[{"slug":"2023-07-11-principles-of-devops-introduction","frontmatter":{"title":"Principles of DevOps: Introduction","date":"2023-07-11","tags":"note, practices, devops, PrinciplesOfDevOps"},"tags":["note","practices","devops","PrinciplesOfDevOps"]},{"slug":"2023-05-19-work-batch-sizing","frontmatter":{"title":"Optimizing work batch size","date":"2023-05-19","tags":"100DaysToOffload, note, practices, learnings, life, devops"},"tags":["100DaysToOffload","note","practices","learnings","life","devops"]},{"slug":"2023-04-22-the-role-of-a-devops-engineer","frontmatter":{"title":"The role of a DevOps Engineer","date":"2023-04-22","tags":"100DaysToOffload, note, practices, devops"},"tags":["100DaysToOffload","note","practices","devops"]},{"slug":"2023-04-12-instant-dark-theme","frontmatter":{"title":"Instant dark theme","date":"2023-04-12","tags":"100DaysToOffload, guide, note, learnings, web, css, til"},"tags":["100DaysToOffload","guide","note","learnings","web","css","til"]},{"slug":"2023-03-30-designing-resilient-cloud-infrastructure","frontmatter":{"title":"Designing resilient cloud infrastructure","date":"2023-03-30","tags":"100DaysToOffload, infrastructure, aws, guide, note, learnings"},"tags":["100DaysToOffload","infrastructure","aws","guide","note","learnings"]}]},"__N_SSG":true},"page":"/posts/[post]","query":{"post":"2023-04-28-serverless-framework-retrospective"},"buildId":"HsdJIwXJDgyLfxcJkrRTY","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>