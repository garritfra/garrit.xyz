<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><title>Mistakes I made writing my first compiler, and what I would do better next time | Garrit&#x27;s Notes</title><meta name="Description" content="Generalist software developer writing about scalable infrastructure, fullstack development and DevOps practices."/><link rel="icon" type="image/svg+xml" href="/favicon.svg"/><link rel="manifest" href="/site.webmanifest"/><link rel="webmention" href="https://webmention.io/garrit.xyz/webmention"/><link rel="pingback" href="https://webmention.io/garrit.xyz/xmlrpc"/><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/935debb317df188e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/935debb317df188e.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-144ddb6b9c2105c7.js" defer=""></script><script src="/_next/static/chunks/main-2ec2bff4dc625bbc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5d4795abae9e13c0.js" defer=""></script><script src="/_next/static/chunks/630-15567ca4e241c039.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bpost%5D-276741fc94169dfe.js" defer=""></script><script src="/_next/static/fAMqpdG50EgIf9-wXLxHF/_buildManifest.js" defer=""></script><script src="/_next/static/fAMqpdG50EgIf9-wXLxHF/_ssgManifest.js" defer=""></script></head><body><div id="__next"><section class="layout"><header class="header"><nav class="nav" role="navigation" aria-label="main navigation"><div class="header__container"><a href="/" class="header__container__logo">Garrit&#x27;s Notes</a></div><ul class="header__links"><li><a href="/posts">Blog</a></li><li><a href="/contact">Contact</a></li><li><a href="/links">More ...</a></li></ul></nav></header><div class="content"><article class="page h-entry"><div class="page__info"><h1 class="p-name">Mistakes I made writing my first compiler, and what I would do better next time</h1><time class="page__info__date">Nov 28 2022</time><p class="tag-list"><a href="/posts?tags=note">#<!-- -->note</a><a href="/posts?tags=100DaysToOffload">#<!-- -->100DaysToOffload</a></p></div><div class="page__body e-content"><p>My most ambitious side project so far has been the <a href="https://github.com/antimony-lang/antimony">Antimony Programming
Language</a>. It&#x27;s a compiler for a
programming language I made up about two years ago. It can be used for basic
programs and algorithms, but anything beyond
<a href="https://github.com/antimony-lang/antimony/blob/master/examples/bubblesort.sb">bubblesort</a>
and the <a href="https://github.com/antimony-lang/antimony/blob/master/examples/ackermann.sb">ackermann
function</a>
wasn&#x27;t feasible.</p>
<p>Unfortunately, the language never grew out of the &quot;toy&quot; phase, so I more or less
abandoned it. Looking back, I definitely learned a lot about compilers, and if I
were to write another language (which I will most likely do in the future),
there are some things that I would do better next time.</p>
<h2 id="statements-are-expressions-minus-flexibility">Statements are expressions minus flexibility</h2>
<p>The syntax of many C-like programming languages can be broken up into two
categories. An <code>Expression</code> is anything that resolves a value.</p>
<pre><code class="language-c">1 + 2       // 3
5 * 8 + 2   // 42
1 &lt; 2       // true
addOne(1)   // 2 (assuming `addOne` returns the given value plus one)
[1, 2, 3]   // Array containing a 1, a 2 and a 3
</code></pre>
<p>A <code>Statement</code> resembles an action or branch in a program.</p>
<pre><code class="language-c">int foo() {                 // Declare statement
    int bar = 1;            // Assignment statement
    if (bar &gt;= 1) {         // Conditional statement
        printf(&quot;%d&quot;, bar);  // Function call expressions can be statements too!
    }
}
</code></pre>
<p>Antimony picks up on this concept, and strictly separates statements from
expressions. Some modern programming languages (E.g.
<a href="https://rust-lang.org/">Rust</a>) got rid of most types of statements by just
declaring almost anything an expression. There are just <a href="https://doc.rust-lang.org/reference/statements.html#declaration-statements">Declaration
Statements</a>
used for function and variable declaration, and <a href="https://doc.rust-lang.org/reference/statements.html#expression-statements">Expression
Statements</a>,
which can contain any arbitrary expression. This allows us to introduce a lot of
nice features that are very hard to implement if we treated statements as actual statements</p>
<pre><code class="language-rust">let foo = if 1 &gt; 2 {
    1
} else {
    for {
        break 2
    }
}

print(foo)  // 2
</code></pre>
<p>Unfortunately, I realized the benefits of extensively using expressions too late.</p>
<p>TODO</p>
<h2 id="don&#x27;t-add-types-as-an-afterthought">Don&#x27;t add types as an afterthought</h2>
<h2 id="multiple-backends-=-exponential-headaches">Multiple backends = exponential headaches</h2>
<h2 id="&quot;i-won&#x27;t-need-an-ir&quot;-is-a-lie">&quot;I won&#x27;t need an IR&quot; is a lie</h2><p class="horizontal-list"><button>üíåÔ∏è Reply via E-Mail</button><button>üîó Share</button><button>‚úèÔ∏è Fix Typo</button></p><hr/><h2>Continue Reading</h2><div></div></div></article></div><footer class="footer"><div class="notice"><p>I invite you to read my new book<!-- --> <a target="_blank" href="https://www.buymeacoffee.com/garrit/e/233695">Five Years of Blogging: Ideas, Opinions and Guides written 2019 to 2024</a>. Becoming a member on<!-- --> <a target="_blank" href="https://www.buymeacoffee.com/garrit">Buy Me a Coffee</a> <!-- -->will grant you free access to the book!</p><a href="https://www.buymeacoffee.com/garrit/extras"><img src="/assets/five-years-of-blogging-cover-3d.png" alt="Cover of Five Years of Blogging" loading="lazy"/></a></div><div class="footer__content"><h3>Links of Interest</h3><a href="/rss.xml">RSS Feed</a><br/><a href="/todo">Todo List</a><br/><a href="https://keys.openpgp.org/vks/v1/by-fingerprint/2218337E54AA1DBE207B404DBB54AF7EB0939F3D">PGP Key</a><br/><a href="/guestbook">Guestbook</a><br/><a href="/blogroll">Blogroll</a><br/><a href="/ctf">Capture the Flag</a><h3>Elsewhere</h3><a href="https://github.com/garritfra" rel="me">Github</a><br/><a href="https://www.linkedin.com/in/garritfranke/">LinkedIn</a><br/><a href="https://fosstodon.org/@garritfra">Mastodon (ActivityPub)</a><br/><a href="/contact">Contact</a></div><a href="https://www.buymeacoffee.com/garrit" target="_blank"><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a tea&amp;emoji=&amp;slug=garrit&amp;button_colour=FFB300&amp;font_colour=000000&amp;font_family=Cookie&amp;outline_colour=000000&amp;coffee_colour=ffffff"/></a><p>üëª Proud member of<!-- --> <a target="_blank" href="https://darktheme.club/">darktheme.club</a> <!-- -->üëª</p><p>¬© 2018-<!-- -->2025<!-- --> Garrit Franke<br/><a href="/privacy">Privacy</a> |<!-- --> <a target="_blank" href="https://github.com/garritfra/garrit.xyz">Source Code</a></p></footer></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"_2022-11-28-mistakes-i-made-writing-my-first-compiler,-and-what-i-would-do-better-next-time","markdownBody":"\nMy most ambitious side project so far has been the [Antimony Programming\nLanguage](https://github.com/antimony-lang/antimony). It's a compiler for a\nprogramming language I made up about two years ago. It can be used for basic\nprograms and algorithms, but anything beyond\n[bubblesort](https://github.com/antimony-lang/antimony/blob/master/examples/bubblesort.sb)\nand the [ackermann\nfunction](https://github.com/antimony-lang/antimony/blob/master/examples/ackermann.sb)\nwasn't feasible.\n\nUnfortunately, the language never grew out of the \"toy\" phase, so I more or less\nabandoned it. Looking back, I definitely learned a lot about compilers, and if I\nwere to write another language (which I will most likely do in the future),\nthere are some things that I would do better next time.\n\n## Statements are expressions minus flexibility\n\nThe syntax of many C-like programming languages can be broken up into two\ncategories. An `Expression` is anything that resolves a value.\n\n```c\n1 + 2       // 3\n5 * 8 + 2   // 42\n1 \u003c 2       // true\naddOne(1)   // 2 (assuming `addOne` returns the given value plus one)\n[1, 2, 3]   // Array containing a 1, a 2 and a 3\n```\n\nA `Statement` resembles an action or branch in a program.\n\n```c\nint foo() {                 // Declare statement\n    int bar = 1;            // Assignment statement\n    if (bar \u003e= 1) {         // Conditional statement\n        printf(\"%d\", bar);  // Function call expressions can be statements too!\n    }\n}\n```\n\nAntimony picks up on this concept, and strictly separates statements from\nexpressions. Some modern programming languages (E.g.\n[Rust](https://rust-lang.org/)) got rid of most types of statements by just\ndeclaring almost anything an expression. There are just [Declaration\nStatements](https://doc.rust-lang.org/reference/statements.html#declaration-statements)\nused for function and variable declaration, and [Expression\nStatements](https://doc.rust-lang.org/reference/statements.html#expression-statements),\nwhich can contain any arbitrary expression. This allows us to introduce a lot of\nnice features that are very hard to implement if we treated statements as actual statements\n\n```rust\nlet foo = if 1 \u003e 2 {\n    1\n} else {\n    for {\n        break 2\n    }\n}\n\nprint(foo)  // 2\n```\n\nUnfortunately, I realized the benefits of extensively using expressions too late.\n\nTODO\n\n## Don't add types as an afterthought\n\n## Multiple backends = exponential headaches\n\n## \"I won't need an IR\" is a lie\n","frontmatter":{"title":"Mistakes I made writing my first compiler, and what I would do better next time","date":"2022-11-28","tags":"note, 100DaysToOffload"},"tags":["note","100DaysToOffload"]},"recommendedPosts":[]},"__N_SSG":true},"page":"/posts/[post]","query":{"post":"_2022-11-28-mistakes-i-made-writing-my-first-compiler,-and-what-i-would-do-better-next-time"},"buildId":"fAMqpdG50EgIf9-wXLxHF","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>