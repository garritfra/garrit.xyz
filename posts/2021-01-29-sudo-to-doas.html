<!DOCTYPE html><html><head><script async="" defer="" data-domain="garrit.xyz" src="https://analytics.slashdev.space/js/plausible.outbound-links.js"></script><script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><title>Garrit&#x27;s Notes</title><meta name="Description" content="Generalist developer writing about fullstack development, system administration and free software."/><link rel="icon" type="image/svg+xml" href="/favicon.svg"/><link rel="webmention" href="https://webmention.io/garrit.xyz/webmention"/><link rel="pingback" href="https://webmention.io/garrit.xyz/xmlrpc"/><meta name="next-head-count" content="9"/><link rel="preload" href="https://garrit.xyz/_next/static/css/309c5918964c6e74.css" as="style"/><link rel="stylesheet" href="https://garrit.xyz/_next/static/css/309c5918964c6e74.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="https://garrit.xyz/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="https://garrit.xyz/_next/static/chunks/webpack-419417af898ef431.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/main-01df828e572375b9.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/pages/_app-6297bfd2dcc78ba7.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/988-48b55eebb161e8d8.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/746-6cb8fd2335c400fd.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/768-d1db3457a00e9fa7.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/pages/posts/%5Bpost%5D-4aa53c557862db9a.js" defer=""></script><script src="https://garrit.xyz/_next/static/3VEfxPvzNTFu7qA0ZKQh9/_buildManifest.js" defer=""></script><script src="https://garrit.xyz/_next/static/3VEfxPvzNTFu7qA0ZKQh9/_ssgManifest.js" defer=""></script><script src="https://garrit.xyz/_next/static/3VEfxPvzNTFu7qA0ZKQh9/_middlewareManifest.js" defer=""></script><style id="__jsx-8946a52cf42f2313">.layout.jsx-8946a52cf42f2313{overflow-x:hidden;
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column;
min-height:100vh}
.layout.jsx-8946a52cf42f2313 .info_page.jsx-8946a52cf42f2313{color:#ebebeb}
.content.jsx-8946a52cf42f2313{}
@media (min-width:768px) {}</style></head><body><div id="__next" data-reactroot=""><section class="jsx-8946a52cf42f2313 layout"><header class="header"><a href="https://www.comebackalive.in.ua/" style="height:64px;text-align:center" class="flag--ukraine" target="_blank">Help Ukraine</a><nav class="nav" role="navigation" aria-label="main navigation"><div class="header__container"><a href="/" class="header__container__logo underlined">Garrit&#x27;s Notes</a></div><ul class="header__links"><li><a href="/posts" class="underlined">Blog</a></li><li><a href="/contact" class="underlined">Contact</a></li><li><a href="/cv" class="underlined">Resume</a></li></ul></nav></header><div class="jsx-8946a52cf42f2313 content"><article class="page h-entry"><div class="page__info"><h1 class="p-name">From sudo to doas</h1><h3 class="page__info__date">Jan 29 2021</h3></div><div class="page__body e-content"><p>You might have heard that there is currently <a href="https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt">a pretty significant vulnerability</a> affecting <code>sudo</code>, the program we all know and love. It is the de facto standard for when you want to run a command as a priviledged user, but that&#x27;s really it. Under the hood, sudo is a very powerful tool with a lot of features. It can be used to build out complex permission-systems that span across entire clusters of servers. But all of these features come at a price: <strong>complexity</strong>. Last time I checked, the <a href="https://www.sudo.ws/repos/sudo">source code</a> of sudo had about 330k lines of code (using cloc as a benchmark). This massive complexity plays a large role in its security.</p>
<p>Luckily, there is a <strong>far</strong> more lightweight alternative to sudo called <a href="https://github.com/Duncaen/OpenDoas.git">doas</a>. It essentially does all the things you&#x27;d expect from sudo for your average end user. Doas is written in just over 3k lines of code, which, if you think of it, should be more than enough to provide a tool that executes a command as a priviledged user.</p>
<h2 id="setup" level="2">Setup</h2>
<p>While there are packages for <a href="https://github.com/slicer69/doas#installation-via-packagesrepositories">some distibutions</a>, I personally had trouble setting it up on arch using yay (for permission reasons, ironically). I recommend going the extra mile and building it from source, which consists of a few commands and some seconds of your time:</p>
<pre><code class="language-sh">git clone https://github.com/slicer69/doas
cd doas
make
sudo make install
</code></pre>
<p>Next, you will need to create a config file at <code>/usr/local/etc/doas.conf</code>. Paste the following line into it to give your user root access:</p>
<pre><code class="language-sh">permit alice as root
</code></pre>
<p>You obviously want to substitute alice with your username. If you have multiple users on your system, simply duplicate that line and substitute the username accordingly. Just restart your terminal window, and you should be able to run programs as root using doas instead of sudo:</p>
<pre><code class="language-sh">➜  ~ doas id
uid=0(root) gid=0(root) groups=0(root)
</code></pre>
<h2 id="bonus:-save-your-muscle-memory" level="2">Bonus: Save your muscle memory</h2>
<p>If you still want to &quot;use&quot; sudo on your machine, you can set up a simple alias in your <code>.{bash|zsh|fish}rc</code>. This will also help with compatibility issues of some scripts, if you decide to ditch the actual sudo from your Box entirely. Just paste this line into your corresponding rc file:</p>
<pre><code>alias sudo=&quot;doas&quot;
</code></pre>
<h2 id="bonus-bonus:-passwordless-authentification" level="2">Bonus Bonus: Passwordless authentification</h2>
<p>You can setup doas to skip the password prompt every time you run a command with it. Simply add the <code>nopass</code> option in your doas configuration file:</p>
<pre><code class="language-sh">permit nopass alice as root
</code></pre>
<p>I hope you found this useful!</p>
<p>This is post 008 of <a href="https://100daystooffload.com/">#100DaysToOffload</a>.</p><hr/><p><a href="mailto:garrit@slashdev.space?subject=Re: From%20sudo%20to%20doas">Reply via E-Mail</a></p><div class="page__tag-list"><svg class="page__tag-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><a href="/posts?tags=linux">#<!-- -->linux</a><a href="/posts?tags=100DaysToOffload">#<!-- -->100DaysToOffload</a><a href="/posts?tags=guide">#<!-- -->guide</a></div></div></article></div><footer class="footer"><div class="footer__content"><section class="footer__content__links"><h3>Links of Interest</h3><a href="/rss.xml">RSS Feed</a><br/><a href="/todo">Todo List</a><br/><a href="https://keyoxide.org/hkp/garrit@slashdev.space">PGP Key</a><br/><a href="/blogroll">Blogroll</a></section><section class="footer__content__social"><h3>Elsewhere</h3><a href="https://github.com/garritfra" rel="me">Github</a><br/><a href="https://www.linkedin.com/in/garritfranke/">LinkedIn</a><br/><a href="https://fosstodon.org/@garritfra">Mastodon (ActivityPub)</a><br/><a href="/contact">Contact</a></section></div><p>© 2018-2022 Garrit Franke</p></footer></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"title":"From sudo to doas","date":"2021-01-29","tags":"linux, 100DaysToOffload, guide"},"markdownBody":"\nYou might have heard that there is currently [a pretty significant vulnerability](https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt) affecting `sudo`, the program we all know and love. It is the de facto standard for when you want to run a command as a priviledged user, but that's really it. Under the hood, sudo is a very powerful tool with a lot of features. It can be used to build out complex permission-systems that span across entire clusters of servers. But all of these features come at a price: **complexity**. Last time I checked, the [source code](https://www.sudo.ws/repos/sudo) of sudo had about 330k lines of code (using cloc as a benchmark). This massive complexity plays a large role in its security.\n\nLuckily, there is a **far** more lightweight alternative to sudo called [doas](https://github.com/Duncaen/OpenDoas.git). It essentially does all the things you'd expect from sudo for your average end user. Doas is written in just over 3k lines of code, which, if you think of it, should be more than enough to provide a tool that executes a command as a priviledged user.\n\n## Setup\n\nWhile there are packages for [some distibutions](https://github.com/slicer69/doas#installation-via-packagesrepositories), I personally had trouble setting it up on arch using yay (for permission reasons, ironically). I recommend going the extra mile and building it from source, which consists of a few commands and some seconds of your time:\n\n```sh\ngit clone https://github.com/slicer69/doas\ncd doas\nmake\nsudo make install\n```\n\nNext, you will need to create a config file at `/usr/local/etc/doas.conf`. Paste the following line into it to give your user root access:\n\n```sh\npermit alice as root\n```\n\nYou obviously want to substitute alice with your username. If you have multiple users on your system, simply duplicate that line and substitute the username accordingly. Just restart your terminal window, and you should be able to run programs as root using doas instead of sudo:\n\n```sh\n➜  ~ doas id\nuid=0(root) gid=0(root) groups=0(root)\n```\n\n## Bonus: Save your muscle memory\n\nIf you still want to \"use\" sudo on your machine, you can set up a simple alias in your `.{bash|zsh|fish}rc`. This will also help with compatibility issues of some scripts, if you decide to ditch the actual sudo from your Box entirely. Just paste this line into your corresponding rc file:\n\n```\nalias sudo=\"doas\"\n```\n\n## Bonus Bonus: Passwordless authentification\n\nYou can setup doas to skip the password prompt every time you run a command with it. Simply add the `nopass` option in your doas configuration file:\n\n```sh\npermit nopass alice as root\n```\n\nI hope you found this useful!\n\nThis is post 008 of [#100DaysToOffload](https://100daystooffload.com/).\n"},"__N_SSG":true},"page":"/posts/[post]","query":{"post":"2021-01-29-sudo-to-doas"},"buildId":"3VEfxPvzNTFu7qA0ZKQh9","assetPrefix":"https://garrit.xyz","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>