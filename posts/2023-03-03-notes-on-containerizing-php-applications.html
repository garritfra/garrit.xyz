<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><title>Notes on containerizing PHP applications | Garrit&#x27;s Notes</title><meta name="Description" content="Generalist software developer writing about scalable infrastructure, fullstack development and DevOps practices."/><link rel="icon" type="image/svg+xml" href="/favicon.svg"/><link rel="manifest" href="/site.webmanifest"/><link rel="webmention" href="https://webmention.io/garrit.xyz/webmention"/><link rel="pingback" href="https://webmention.io/garrit.xyz/xmlrpc"/><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/935debb317df188e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/935debb317df188e.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-144ddb6b9c2105c7.js" defer=""></script><script src="/_next/static/chunks/main-e5e349bb2d39155a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5d4795abae9e13c0.js" defer=""></script><script src="/_next/static/chunks/630-47f0f098612a0c8e.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bpost%5D-370373fdc099b182.js" defer=""></script><script src="/_next/static/UGOxDbtHBY5gLoclaEDYA/_buildManifest.js" defer=""></script><script src="/_next/static/UGOxDbtHBY5gLoclaEDYA/_ssgManifest.js" defer=""></script></head><body><div id="__next"><section class="layout"><header class="header"><nav class="nav" role="navigation" aria-label="main navigation"><div class="header__container"><a href="/" class="header__container__logo">Garrit&#x27;s Notes</a></div><ul class="header__links"><li><a href="/posts">Blog</a></li><li><a href="/contact">Contact</a></li><li><a href="/links">More ...</a></li></ul></nav></header><div class="content"><article class="page h-entry"><div class="page__info"><h1 class="p-name">Notes on containerizing PHP applications</h1><time class="page__info__date">Mar 03 2023</time><p class="tag-list"><a href="/posts?tags=note">#<!-- -->note</a><a href="/posts?tags=infrastructure">#<!-- -->infrastructure</a><a href="/posts?tags=docker">#<!-- -->docker</a><a href="/posts?tags=php">#<!-- -->php</a><a href="/posts?tags=100DaysToOffload">#<!-- -->100DaysToOffload</a><a href="/posts?tags=tech">#<!-- -->tech</a></p></div><div class="page__body e-content"><p>I was recently tasked with building a rudimentary infrastructure for a PHP application. Coming from a Node.js-driven world where every human and their grandmother has a blog post about containerizing your application, it was very interesting to see where PHP differs to other applications.</p>
<p>One major gotcha for me was that PHP code is executed on <strong>request-time</strong>, meaning a new process is spawned for each incoming request. Most other languages have dedicated runtimes that handle incoming requests. This unique approach is very flexible and scalable, but it comes with the implication that there is a <strong>separate webserver</strong> that calls into the PHP interpreter when it needs to.</p>
<p>In Node.js (and most other languages), you can &quot;just run the app&quot;, as demonstrated by this Dockerfile:</p>
<pre><code class="language-dockerfile">FROM node:18.14.2-alpine3.17 AS build

WORKDIR /usr/src/app

COPY package*.json ./

RUN npm ci

COPY . .

EXPOSE 3000

CMD [ &quot;node&quot;, &quot;server.js&quot; ]
</code></pre>
<p>PHP on the other side is rarely used on its own. Most of the time, it needs a webserver alongside it:</p>
<pre><code class="language-dockerfile">FROM php:8.1-apache-bullseye

# &lt;snip&gt;

COPY . /var/www/html
WORKDIR /var/www/html

# &lt;snip&gt;
</code></pre>
<p>As you can see, I&#x27;m using the official PHP docker image. The PHP maintainers know that adding a webserver alongside PHP is a very common pattern, so most of the variants of the image ship with a webserver. In this example I&#x27;m using Apache, but we might as well use NGINX or some other webserver. There&#x27;s also the option to use <a href="https://www.php.net/manual/de/install.fpm.php">FPM</a> as a FastCGI implementation and a webserver in a <strong>separate</strong> container.</p>
<p>Grasping this took me some time, but after it clicked it made many things a lot clearer.</p>
<h2 id="more-complete-dockerfile-example">More complete Dockerfile example</h2>
<p>The Dockerfile above is meant to demonstrate how PHP applications differ from other languages. The following is a more complete example you can use to containerize your PHP application. In this case it‚Äôs a Laravel app, so your mileage may vary.</p>
<pre><code class="language-dockerfile">FROM php:8.1-apache-bullseye

RUN apt-get clean &amp;&amp; \
    apt-get update &amp;&amp; \
    apt-get install --fix-missing -y \
        zip &amp;&amp; \
    docker-php-ext-install \
        pdo \
        pdo_mysql \
        bcmath

COPY --from=composer:2 /usr/bin/composer /usr/bin/composer

COPY . /var/www/html
WORKDIR /var/www/html

ENV APACHE_DOCUMENT_ROOT /var/www/html/public

RUN composer install --no-dev --optimize-autoloader --no-interaction &amp;&amp; \
    sed -ri -e &#x27;s!/var/www/html!${APACHE_DOCUMENT_ROOT}!g&#x27; /etc/apache2/sites-available/*.conf &amp;&amp; \
    sed -ri -e &#x27;s!/var/www/!${APACHE_DOCUMENT_ROOT}!g&#x27; /etc/apache2/apache2.conf /etc/apache2/conf-available/*.conf &amp;&amp; \
    php artisan config:cache &amp;&amp; \
    php artisan view:cache &amp;&amp; \
    php artisan route:cache &amp;&amp; \
    php artisan storage:link &amp;&amp; \
    chmod 777 -R /var/www/html/storage/ &amp;&amp; \
    chown -R www-data:www-data /var/www/ &amp;&amp; \
    a2enmod rewrite
</code></pre>
<hr/>
<p>This is post 052 of <a href="https://100daystooffload.com/">#100DaysToOffload</a>.</p><p class="horizontal-list"><button>üíåÔ∏è Reply via E-Mail</button><button>üîó Share</button><button>‚úèÔ∏è Fix Typo</button></p><hr/><h2>Continue Reading</h2><div><div class="blog__list__post"><time class="blog__list__post__date">Sep 24 2024</time><br/><a href="/posts/2024-09-24-installing-mssql-client-drivers-for-a-php-application">Installing MSSQL Client Drivers for a PHP Application</a></div><div class="blog__list__post"><time class="blog__list__post__date">Aug 31 2024</time><br/><a href="/posts/2024-08-31-sentiment-analysis-using-ml-models">Sentiment analysis using ML models</a></div><div class="blog__list__post"><time class="blog__list__post__date">Aug 03 2024</time><br/><a href="/posts/2024-08-03-how-embedding-models-encode-semantic-meaning">How embedding models encode semantic meaning</a></div><div class="blog__list__post"><time class="blog__list__post__date">Jul 02 2024</time><br/><a href="/posts/2024-07-02-linkdump-llms">üîó Linkdump: LLMs</a></div><div class="blog__list__post"><time class="blog__list__post__date">Jun 27 2024</time><br/><a href="/posts/2024-06-27-testing-smtp-connections">Testing SMTP connections</a></div></div></div></article></div><footer class="footer"><div class="notice"><p>I invite you to read my new book<!-- --> <a target="_blank" href="https://www.buymeacoffee.com/garrit/e/233695">Five Years of Blogging: Ideas, Opinions and Guides written 2019 to 2024</a>. Becoming a member on<!-- --> <a target="_blank" href="https://www.buymeacoffee.com/garrit">Buy Me a Coffee</a> <!-- -->will grant you free access to the book!</p><a href="https://www.buymeacoffee.com/garrit/extras"><img src="/assets/five-years-of-blogging-cover-3d.png" alt="Cover of Five Years of Blogging" loading="lazy"/></a></div><div class="footer__content"><h3>Links of Interest</h3><a href="/rss.xml">RSS Feed</a><br/><a href="/todo">Todo List</a><br/><a href="https://keys.openpgp.org/vks/v1/by-fingerprint/2218337E54AA1DBE207B404DBB54AF7EB0939F3D">PGP Key</a><br/><a href="/guestbook">Guestbook</a><br/><a href="/blogroll">Blogroll</a><br/><a href="/ctf">Capture the Flag</a><h3>Elsewhere</h3><a href="https://github.com/garritfra" rel="me">Github</a><br/><a href="https://www.linkedin.com/in/garritfranke/">LinkedIn</a><br/><a href="https://fosstodon.org/@garritfra">Mastodon (ActivityPub)</a><br/><a href="/contact">Contact</a></div><a href="https://www.buymeacoffee.com/garrit" target="_blank"><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a tea&amp;emoji=&amp;slug=garrit&amp;button_colour=FFB300&amp;font_colour=000000&amp;font_family=Cookie&amp;outline_colour=000000&amp;coffee_colour=ffffff"/></a><p>üëª Proud member of<!-- --> <a target="_blank" href="https://darktheme.club/">darktheme.club</a> <!-- -->üëª</p><p>¬© 2018-<!-- -->2025<!-- --> Garrit Franke<br/><a href="/privacy">Privacy</a> |<!-- --> <a target="_blank" href="https://github.com/garritfra/garrit.xyz">Source Code</a></p></footer></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"2023-03-03-notes-on-containerizing-php-applications","markdownBody":"\r\nI was recently tasked with building a rudimentary infrastructure for a PHP application. Coming from a Node.js-driven world where every human and their grandmother has a blog post about containerizing your application, it was very interesting to see where PHP differs to other applications.\r\n\r\nOne major gotcha for me was that PHP code is executed on **request-time**, meaning a new process is spawned for each incoming request. Most other languages have dedicated runtimes that handle incoming requests. This unique approach is very flexible and scalable, but it comes with the implication that there is a **separate webserver** that calls into the PHP interpreter when it needs to.\r\n\r\nIn Node.js (and most other languages), you can \"just run the app\", as demonstrated by this Dockerfile:\r\n\r\n```dockerfile\r\nFROM node:18.14.2-alpine3.17 AS build\r\n\r\nWORKDIR /usr/src/app\r\n\r\nCOPY package*.json ./\r\n\r\nRUN npm ci\r\n\r\nCOPY . .\r\n\r\nEXPOSE 3000\r\n\r\nCMD [ \"node\", \"server.js\" ]\r\n```\r\n\r\nPHP on the other side is rarely used on its own. Most of the time, it needs a webserver alongside it:\r\n\r\n```dockerfile\r\nFROM php:8.1-apache-bullseye\r\n\r\n# \u003csnip\u003e\r\n\r\nCOPY . /var/www/html\r\nWORKDIR /var/www/html\r\n\r\n# \u003csnip\u003e\r\n```\r\n\r\nAs you can see, I'm using the official PHP docker image. The PHP maintainers know that adding a webserver alongside PHP is a very common pattern, so most of the variants of the image ship with a webserver. In this example I'm using Apache, but we might as well use NGINX or some other webserver. There's also the option to use [FPM](https://www.php.net/manual/de/install.fpm.php) as a FastCGI implementation and a webserver in a **separate** container.\r\n\r\nGrasping this took me some time, but after it clicked it made many things a lot clearer.\r\n\r\n## More complete Dockerfile example\r\n\r\nThe Dockerfile above is meant to demonstrate how PHP applications differ from other languages. The following is a more complete example you can use to containerize your PHP application. In this case it‚Äôs a Laravel app, so your mileage may vary.\r\n\r\n```dockerfile\r\nFROM php:8.1-apache-bullseye\r\n\r\nRUN apt-get clean \u0026\u0026 \\\r\n    apt-get update \u0026\u0026 \\\r\n    apt-get install --fix-missing -y \\\r\n        zip \u0026\u0026 \\\r\n    docker-php-ext-install \\\r\n        pdo \\\r\n        pdo_mysql \\\r\n        bcmath\r\n\r\nCOPY --from=composer:2 /usr/bin/composer /usr/bin/composer\r\n\r\nCOPY . /var/www/html\r\nWORKDIR /var/www/html\r\n\r\nENV APACHE_DOCUMENT_ROOT /var/www/html/public\r\n\r\nRUN composer install --no-dev --optimize-autoloader --no-interaction \u0026\u0026 \\\r\n    sed -ri -e 's!/var/www/html!${APACHE_DOCUMENT_ROOT}!g' /etc/apache2/sites-available/*.conf \u0026\u0026 \\\r\n    sed -ri -e 's!/var/www/!${APACHE_DOCUMENT_ROOT}!g' /etc/apache2/apache2.conf /etc/apache2/conf-available/*.conf \u0026\u0026 \\\r\n    php artisan config:cache \u0026\u0026 \\\r\n    php artisan view:cache \u0026\u0026 \\\r\n    php artisan route:cache \u0026\u0026 \\\r\n    php artisan storage:link \u0026\u0026 \\\r\n    chmod 777 -R /var/www/html/storage/ \u0026\u0026 \\\r\n    chown -R www-data:www-data /var/www/ \u0026\u0026 \\\r\n    a2enmod rewrite\r\n```\r\n\r\n---\r\nThis is post 052 of [#100DaysToOffload](https://100daystooffload.com/).\r\n","frontmatter":{"title":"Notes on containerizing PHP applications","date":"2023-03-03","tags":"note, infrastructure, docker, php, 100DaysToOffload, tech"},"tags":["note","infrastructure","docker","php","100DaysToOffload","tech"]},"recommendedPosts":[{"slug":"2024-09-24-installing-mssql-client-drivers-for-a-php-application","frontmatter":{"title":"Installing MSSQL Client Drivers for a PHP Application","date":"2024-09-24","tags":"guide, note, web, tech, programming, php"},"tags":["guide","note","web","tech","programming","php"]},{"slug":"2024-08-31-sentiment-analysis-using-ml-models","frontmatter":{"title":"Sentiment analysis using ML models","date":"2024-08-31","tags":"note, tech, ai"},"tags":["note","tech","ai"]},{"slug":"2024-08-03-how-embedding-models-encode-semantic-meaning","frontmatter":{"title":"How embedding models encode semantic meaning","date":"2024-08-03","tags":"note, tech, math, llm, ai"},"tags":["note","tech","math","llm","ai"]},{"slug":"2024-07-02-linkdump-llms","frontmatter":{"title":"üîó Linkdump: LLMs","date":"2024-07-02","tags":"note, tech, linkdump, llm, ai"},"tags":["note","tech","linkdump","llm","ai"]},{"slug":"2024-06-27-testing-smtp-connections","frontmatter":{"title":"Testing SMTP connections","date":"2024-06-27","tags":"infrastructure, guide, note, learnings, tech"},"tags":["infrastructure","guide","note","learnings","tech"]}]},"__N_SSG":true},"page":"/posts/[post]","query":{"post":"2023-03-03-notes-on-containerizing-php-applications"},"buildId":"UGOxDbtHBY5gLoclaEDYA","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>